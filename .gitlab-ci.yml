# taken from https://gitlab.com/PPW-2017/ppw-lab-ki/blob/master/.gitlab-ci.yml and https://gitlab.com/ilmannafian04/ppw-lab-template/-/blob/master/.gitlab-ci.yml
stages:
  - test
  - deploy

UnitTest:
  stage: test
  image: python:3.6
  before_script:
    - apt-get update -qy
    - apt-get install -y python-dev python-pip
    - pip install -r requirements.txt
    - python manage.py migrate
    - python manage.py collectstatic --noinput
  script:
    - coverage run --include="corona_test/*" manage.py test
    - coverage report -m
  coverage: '/TOTAL.+ ([0-9]{1,3}%)/'

Deployment:
  stage: deploy
  image: ruby
  before_script:
    - gem install dpl
  script:
    - dpl --provider=heroku --app=$HEROKU_APPNAME --api-key=$HEROKU_APIKEY